<?xml version="1.0" encoding="UTF-8"?>
<!--
To change this template, choose Tools | Templates
and open the template in the editor.
-->

<ui:composition xmlns:h="http://java.sun.com/jsf/html"
                template="./../../templates/commonLayout.xhtml"
                xmlns:p="http://primefaces.org/ui"
                xmlns:f="http://java.sun.com/jsf/core"
                xmlns:ui="http://java.sun.com/jsf/facelets"
                xmlns="http://www.w3.org/1999/xhtml">

    <ui:define name="content">
        <h:outputLabel value="CONSULTAR ASIGNACIONES DE PACIENTES" style="padding: 400px; font-size: 20px; font: " />
        <p:panel id="pnlBuscarAlumno" header="Buscar alumno" rendered="#{consultarAsignacionesBean.rendered}">
            <h:form id="buscarAlumnoForm">
                <h:panelGrid id="gridBusquedaAlumno" cellpadding="3" cellspacing="3" columns="5">
                    <!--p:column>
                        <h:outputLabel value="Nombre o apellido: " />
                    </p:column>
                    <p:column>
                        <p:inputText id="txtNombreAlumno" value="{consultarAsignacionesBean.}" size="50" style=""/>
                    </p:column-->
                    <p:column>
                        <h:outputLabel value="Número de documento: " />
                    </p:column>
                    <p:column>
                        <p:inputText id="txtNumDocumentoAlumno" value="#{consultarAsignacionesBean.nroDocumentoFiltro}" size="50"/>
                    </p:column>
                    <p:column>
                        <p:commandButton value="Buscar" icon="ui-icon-search" id="btnBuscarAlumno" 
                                         actionListener="#{consultarAsignacionesBean.cargarAlumno}"
                                         process="@form"
                                         update="@form, :asignacionesForm:tblResultadoAsignaciones"/>
                    </p:column>
                    <p:column colspan="5">
                        <h:outputLabel value="#{consultarAsignacionesBean.alumno} "/>
                    </p:column>
                    <p:column colspan="5">
                        <h:outputLabel value="#{consultarAsignacionesBean.alumno.documento.numero} "/>
                    </p:column>
                </h:panelGrid>
            </h:form>
        </p:panel>
        <p:panel id="pnlAsignaciones" header="Asignaciones">
            <h:form id="asignacionesForm">
                <h:panelGrid id="gridBusquedaAsignaciones" cellpadding="3" cellspacing="3" columns="4">

                    <p:column>
                        <h:outputLabel value="Materia: " />
                    </p:column>
                    <p:column>
                        <p:selectOneMenu id="selectMateria" value="#{consultarAsignacionesBean.materiaFiltro}"
                                         converter="materiaConverter">
                            <f:selectItem itemLabel="Todas" noSelectionOption="true"/>
                            <f:selectItems value="#{consultarAsignacionesBean.materias}"/>
                        </p:selectOneMenu>
                    </p:column>
                    <p:column>
                        <h:outputLabel value="Estado de asignación: " />
                    </p:column>
                    <p:column>
                        <p:selectOneMenu id="selectEstadoAsignacion" value="#{consultarAsignacionesBean.estadoFiltro}">
                            <f:selectItem itemLabel="Todas" itemValue="#{null}"/>
                            <f:selectItems value="#{consultarAsignacionesBean.estados}"/>
                        </p:selectOneMenu>
                    </p:column>

                    <p:column>
                        <h:outputLabel value="Paciente: " />
                    </p:column>
                    <p:column>
                        <p:inputText id="txtNombrePaciente" value="#{consultarAsignacionesBean.pacienteFiltro}"/>
                    </p:column>
                    <p:column>
                        <h:outputLabel value="Fecha de asignación: " />
                    </p:column>
                    <p:column>
                        <p:calendar id="calFechaAsignación" value="#{consultarAsignacionesBean.fechaFiltro}"/>
                    </p:column>

                    <p:commandButton id="btnFiltrarAsignaciones" value="Filtrar" 
                                     actionListener="#{consultarAsignacionesBean.cargarAsignacionesFiltradas}"
                                     process="@form"
                                     update="tblResultadoAsignaciones"/>

                    <!--
                    -->
                </h:panelGrid>

                <p:dataTable id="tblResultadoAsignaciones" 
                             value="#{consultarAsignacionesBean.asignaciones}"
                             emptyMessage="Alumno sin asignaciones"
                             paginator="true" 
                             selectionMode="single"
                             selection="#{consultarAsignacionesBean.asignacionSeleccionada}"
                             var="a"
                             rowKey="#{a.id}" 
                             editable="#{consultarAsignacionesBean.campoEditable}" editMode="cell">
                    <f:facet name="header">
                        <h:outputText value="Asignaciones del alumno #{consultarAsignacionesBean.alumno}" />
                    </f:facet>
                    <p:column id="colPaciente" headerText="Paciente">
                        <h:outputText value="#{a.paciente}" />
                    </p:column>
                    <p:column id="colDocumento" headerText="Documento">
                        <h:outputText value="#{a.paciente.documento.numero}" />
                    </p:column>
                    <p:column id="colMateria" headerText="Materia">
                        <h:outputText value="#{a.diagnostico.materia.nombre}" />
                    </p:column>
                    <p:column id="colTrabajoPractico" headerText="Trabajo Práctico">
                        <h:outputText value="#{a.diagnostico.trabajoPractico.nombre}" />
                    </p:column>
                    <p:column id="colFechaAsignacion" headerText="Fecha Asignacion">
                        <h:outputText value="#{consultarAsignacionesBean.formatFecha(a.fechaAsignacion)}" />
                    </p:column>
                    <p:column id="colEstado" headerText="Estado Asignacion">
                        <h:outputText value="#{a.estado}" />
                    </p:column>
                    <p:column id="colAcciones" headerText="Acciones">
                        <h:panelGrid columns="3">
                            <p:commandButton id="btnConfirmar" value="Confirmar" icon="ui-icon-check"
                                             oncomplete="dlgConfirmar.show();" 
                                             update="tblResultadoAsignaciones"
                                             disabled="#{consultarAsignacionesBean.deshabilitarBtnConfirmarAsignacion(a)}"/>
                            <p:commandButton id="btnCancelar" value="Cancelar" icon="ui-icon-cancel"
                                             oncomplete="dlgCancelarAsignacion.show();"
                                             disabled="#{consultarAsignacionesBean.deshabilitarBtnCancelarAsignacion(a)}"
                                             update="tblResultadoAsignaciones"/>
                            <p:commandButton id="btnModificar" value="Modificar" icon="ui-icon-gear"
                                             disabled="#{consultarAsignacionesBean.deshabilitarBtnModificarAsignacion(a)}"
                                             rendered="#{consultarAsignacionesBean.rendered}"/>
                        </h:panelGrid> 
                    </p:column>
                </p:dataTable>



            </h:form>
        </p:panel>
        <p:confirmDialog message="¿Realmente quiere confirmar la asignación?"
                         header="Confirmación de asignación" severity="alert"
                         widgetVar="dlgConfirmar" appendToBody="true">
            <p:commandButton value="Sí" actionListener="#{consultarAsignacionesBean.confirmarAsignacion()}"
                             oncomplete="dlgConfirmar.hide();"
                             update=":asignacionesForm:tblResultadoAsignaciones"/>
            <p:commandButton value="No" onclick="dlgConfirmar.hide();" type="button" />
        </p:confirmDialog>

        <!--p:confirmDialog message="¿Realmente desea cancelar la asignación?"
                         header="Cancelación de asignación" severity="alert"
                         widgetVar="dlgCancelarAsignacion" appendToBody="true">
            
                             
        </p:confirmDialog-->

        <p:dialog  header="Cancelación de asignación" appendToBody="true"
                   widgetVar="dlgCancelarAsignacion" closeOnEscape="true" modal="true">
            <h:form id="formCancelar">
                <h:panelGrid>

                    <p:row>
                        <h:outputText value="¿Realmente desea cancelar la asignación?"/>
                    </p:row>
                    <p:row>
                        <h:outputText value="Ingrese una descripción del motivo de la cancelación:"/>
                    </p:row>
                    <p:row>
                        <p:inputTextarea id="txtMotivoCancelacion" value="#{consultarAsignacionesBean.motivoCancelacion}" 
                                         maxlength="100" rows="5" cols="35"/>                     
                    </p:row>
                    <p:row>
                        <p:column>
                            <p:commandButton value="Sí" actionListener="#{consultarAsignacionesBean.cancelarAsignacion()}"
                                             oncomplete="dlgCancelarAsignacion.hide();"
                                             process="@form"
                                             update=":asignacionesForm:tblResultadoAsignaciones"/>
                        </p:column>
                        <p:column> 
                            <p:commandButton value="No" onclick="dlgCancelarAsignacion.hide();" type="button"/> 
                        </p:column>
                    </p:row>

                </h:panelGrid>
            </h:form>
        </p:dialog>

        <!--p:dialog header="Confirmar asignación" widgetVar="dlgConfirmarAsignacion" resizable="false" appendToBody="true" modal="true" >
            <h:form id="secondaryForm">
                <p:commandButton value="Seleccionar" id="btnAceptar" 
                                 oncomplete="dlgPacientesEncontrados.hide()"
                                 actionListener="{formPacienteBean.seleccionarPaciente}"
                                 update=":tabsPaciente,
                                 :consultarPacienteForm:pnlConsultarPaciente" />
            </h:form>
        </p:dialog-->
    </ui:define>
</ui:composition>
